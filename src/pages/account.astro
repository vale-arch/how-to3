---
import Layout from '../layouts/Layout.astro';
import Navbar from '../components/Navbar.astro';
import { supabase } from '../lib/supabase';

const { data: { user } } = await supabase.auth.getUser();

if (!user) {
  return Astro.redirect('/login');
}
---

<Layout>
  <Navbar />

  <main class="container mx-auto px-4 py-12 font-lato">
    <h1 class="text-4xl font-bold font-poppins mb-8">My Account</h1>
    <p class="text-lg">Welcome, {user.email}!</p>
    <button id="logout-button" class="bg-red-500 text-white px-6 py-2 rounded-lg hover:bg-red-600 mt-4">Logout</button>
  </main>

  <footer class="text-center py-4 mt-12">
    <p>&copy; {new Date().getFullYear()} HowToKE. All rights reserved.</p>
  </footer>
</Layout>

<script>
  import { supabase } from '../lib/supabase';

  const logoutButton = document.getElementById('logout-button');

  logoutButton.addEventListener('click', async () => {
    const { error } = await supabase.auth.signOut();

    if (error) {
      console.error('Error logging out:', error);
    } else {
      window.location.href = '/';
    }
  });
</script>
